<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Todo List App in JavaScript | CodingNepal</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Include necessary CSS and JavaScript -->
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/11.6.5/sweetalert2.all.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  l
     <link rel="stylesheet" href="{% static 'css/style1.css' %} ">
  
  </head>
  <body>
    <div class="wrapper">
      <form action="{% url 'index' %}?filter={{ filter }}" method="POST">
        {% csrf_token %}
        <div class="task-input">
          <input type="text" id="ok1" name="des" placeholder="Add a new task" />
          <button type="submit" id="ok" style="display:none;"></button>
        </div>
      </form>
      <div class="controls">
        <div class="filters">
          <span class="{% if filter == 'all' %} active {% endif %}">
            <a href="{% url 'index' %}?filter=all" style="text-decoration: none;">All</a>
          </span>
          <span class="{% if filter == 'pending' %} active {% endif %}">
            <a href="{% url 'index' %}?filter=pending" style="text-decoration: none;">Pending</a>
          </span>
          <span class="{% if filter == 'completed' %} active {% endif %}">
            <a href="{% url 'index' %}?filter=completed" style="text-decoration: none;">Completed</a>
          </span>
        </div>
        <a href="{% url 'logout' %}"><i class="fa-solid fa-right-from-bracket"></i></a>
        <a href="{% url "delete_all_task" %}"><i class="fa-solid fa-trash"></i></a>
      </div>
      <ul class="task-box">
        {% for i in task %}
        <li class="task">
          <label for="">
            <input type="checkbox" id="{{ i.id }}" {% if i.completed %} checked {% endif %}/>
            <p class="{% if i.completed %} checked {% endif %}">{{ i.des }}</p>
          </label>
          <div class="settings">
            <i class="uil uil-ellipsis-h"></i>
            <ul class="task-menu">
              <li><i class="uil uil-pen"></i>Edit</li>
              <li><i class="uil uil-trash"></i>Delete</li>
            </ul>
          </div>
        </li>
        {% empty %}
        <li>No tasks found.</li>
        {% endfor %}
    </ul>
    
    </div>
    <script>
      
      document.querySelectorAll('.task input[type="checkbox"]').forEach(checkbox => {
          checkbox.addEventListener('change', function() {
             const taskId = this.id;  //Assuming the id is the task ID
             fetch(`/toggle/${taskId}/`, {
               method: 'POST',
               headers: {
                 'X-CSRFToken': '{{ csrf_token }}',  //Use Django's CSRF token
                 'Content-Type': 'application/json'
               }
             }).then(response => {
               if (response.ok) {
                 location.reload();  //Reload the page to reflect changes
               } else {
                 alert('An error occurred.');
               }
             });
           });
         });
       document.querySelectorAll('.settings i').forEach(icon => {
         icon.addEventListener('click', function() {
           const menu = this.nextElementSibling;
           menu.classList.toggle('show');
         });
       });

       document.getElementById('ok1').addEventListener('change', function() {
         document.getElementById('ok').click();
       }); 


   
    
    </script>
  </body>
</html>
